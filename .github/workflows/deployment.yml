cat > .github/workflows/deployment.yml << 'EOF'
name: Node.js CI/CD
on: push
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Deploy to EC2
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.KEY }}
        port: ${{ secrets.PORT }}
        script: |
          sudo yum install -y nodejs npm nginx git
          mkdir -p /home/ec2-user/todo-api
          cd /home/ec2-user/todo-api
          echo "const express = require('express'); const app = express(); app.get('/', (req, res) => res.send('SUCCESS!')); app.listen(3000);" > app.js
          sudo npm i -g pm2
          npm i express
          pm2 restart todo-api || pm2 start app.js --name todo-api
EOF
