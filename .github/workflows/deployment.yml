cat > .github/workflows/deployment.yml << 'EOF'
name: App Deployment
on: 
  push:
    paths:
      - 'app.js'
      - 'package.json**'
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Deploy to EC2
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.KEY }}
        port: ${{ secrets.PORT }}
        script: |
          sudo yum install -y nodejs npm git nginx -y || sudo dnf install -y nodejs npm git nginx -y
          mkdir -p /home/ec2-user/todo-api && cd /home/ec2-user/todo-api
          cat > app.js << 'APP'
const express = require('express');
const app = express();
app.get('/', (req, res) => res.send('DevSecOps COMPLETE!'));
app.listen(3000, () => console.log('Running on 3000'));
APP
          cat > package.json << 'PKG'
{"name": "todo-api", "version": "1.0.0", "scripts": {"start": "node app.js"}, "dependencies": {"express": "^4.18.2"}}
PKG
          sudo npm i -g pm2 || sudo npm install -g pm2
          npm i
          pm2 restart todo-api || pm2 start app.js --name todo-api
          pm2 save
EOF
